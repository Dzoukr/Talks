

****************************************************************************
****************************************************************************
****************************************************************************
****************************************************************************


----------------------------------------------------------------------------




## Now we have to **connect** Event Store with Domain

----------------------------------------------------------------------------

## Event Serializer

```fsharp
type EventSerializer<'event> = {
    ToEvent : JToken -> 'event
    ToData : 'event -> JToken
}
```

**(De)serialize domain** to Event Store structure

----------------------------------------------------------------------------

## Event Serializer

```fsharp
let toEvent (j:JToken) =
    match j.["name"].Value<string>() with
    | "TaskAdded" -> j.["data"] |> upcastToV2 | TaskAdded
    | "TaskAdded_v2" -> j.["data"] |> evn<CmdArgs.AddTask> | TaskAdded

let toData = function
    | TaskAdded args -> args |> asJToken "TaskAdded"

```
Good place for versioning (upcasting) older events

----------------------------------------------------------------------------

## Event Serializer

There are various ways how to do it. There are only two rules:

You must be able to ** map event** stored in Store **to Domain event**.

You must be able to **map Domain event** to **Store structure**.

*And it is good to think about versions.*

****************************************************************************
****************************************************************************
****************************************************************************
****************************************************************************
****************************************************************************
****************************************************************************
****************************************************************************
****************************************************************************
****************************************************************************
